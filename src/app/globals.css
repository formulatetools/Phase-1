@import "tailwindcss";
@plugin "@tailwindcss/typography";

@custom-variant dark (&:where(.dark, .dark *));

@theme {
  --color-background: #fafaf8;
  --color-foreground: #2d2d2d;
  --color-surface: #ffffff;

  /* Warm charcoal UI primary palette */
  --color-primary-50: #fafaf8;
  --color-primary-100: #f1f0ee;
  --color-primary-200: #e8e8e6;
  --color-primary-300: #d4d4d0;
  --color-primary-400: #999;
  --color-primary-500: #888;
  --color-primary-600: #666;
  --color-primary-700: #444;
  --color-primary-800: #2d2d2d;
  --color-primary-900: #1a1a1a;
  --color-primary-950: #111;

  /* Teal accent (retained for success / secondary) */
  --color-accent-50: #e8f5e9;
  --color-accent-100: #c8e6c9;
  --color-accent-200: #a5d6a7;
  --color-accent-300: #81c784;
  --color-accent-400: #66bb6a;
  --color-accent-500: #16a34a;
  --color-accent-600: #2e7d32;
  --color-accent-700: #1b5e20;
  --color-accent-800: #145218;
  --color-accent-900: #0d3b10;

  /* Brand amber */
  --color-brand: #e4a930;
  --color-brand-light: #fdf6e3;
  --color-brand-dark: #c48d1e;
  --color-brand-text: #9a6e15;

  /* Semantic */
  --color-success: #16a34a;
  --color-warning: #e4a930;
  --color-danger: #dc2626;

  /* Button elevation shadows */
  --shadow-btn: 0 1px 3px rgba(0, 0, 0, 0.08), 0 1px 2px rgba(0, 0, 0, 0.06);
  --shadow-btn-hover: 0 4px 6px rgba(0, 0, 0, 0.1), 0 2px 4px rgba(0, 0, 0, 0.06);

  --font-sans: var(--font-dm-sans);
}

/* ── Dark mode variable overrides — "Bourbon" warm palette ── */
.dark {
  --color-background: #141210;
  --color-foreground: #e8e5e0;
  --color-surface: #1c1a17;

  /* Inverted primary scale — warm bourbon tones (never cold/blue) */
  --color-primary-50: #1c1a17;
  --color-primary-100: #1f1d1a;
  --color-primary-200: #2a2725;
  --color-primary-300: #3a3835;
  --color-primary-400: #5c5853;
  --color-primary-500: #7a7570;
  --color-primary-600: #a8a49e;
  --color-primary-700: #c4c0ba;
  --color-primary-800: #e8e5e0;
  --color-primary-900: #f0ede8;
  --color-primary-950: #f5f3ee;

  /* Accent — brighter greens for dark contrast */
  --color-accent-50: #0d3b10;
  --color-accent-100: #145218;
  --color-accent-200: #1b5e20;
  --color-accent-300: #2e7d32;
  --color-accent-400: #22c55e;
  --color-accent-500: #22c55e;
  --color-accent-600: #4ade80;
  --color-accent-700: #86efac;

  /* Button shadows — stronger on dark backgrounds */
  --shadow-btn: 0 1px 3px rgba(0, 0, 0, 0.3);
  --shadow-btn-hover: 0 4px 6px rgba(0, 0, 0, 0.4);

  /* Brand amber stays vibrant — unchanged, works on both */
  --color-brand: #e4a930;
  --color-brand-light: #1f1d1a;
  --color-brand-dark: #fbbf24;
  --color-brand-text: #fbbf24;

  /* Semantic — slightly brighter for dark backgrounds */
  --color-success: #22c55e;
  --color-warning: #fbbf24;
  --color-danger: #ef4444;

  /* ── Default palette overrides (warm-tinted dark backgrounds) ── */

  /* Green — success states, active badges */
  --color-green-50: #0a1f0d;
  --color-green-100: #14532d;
  --color-green-200: #166534;
  --color-green-300: #15803d;
  --color-green-600: #22c55e;
  --color-green-700: #4ade80;
  --color-green-800: #86efac;

  /* Red — error states, destructive actions */
  --color-red-50: #1f0a0a;
  --color-red-100: #3b1111;
  --color-red-200: #5c1717;
  --color-red-300: #7f1d1d;
  --color-red-500: #ef4444;
  --color-red-600: #f87171;
  --color-red-700: #fca5a5;
  --color-red-800: #fecaca;

  /* Blue — info badges, link-like states */
  --color-blue-50: #0f1a2e;
  --color-blue-100: #172554;
  --color-blue-200: #1e3a8a;
  --color-blue-600: #3b82f6;
  --color-blue-700: #60a5fa;

  /* Amber — warnings, pending states */
  --color-amber-50: #1f1507;
  --color-amber-100: #3b2808;
  --color-amber-200: #5c3d0d;
  --color-amber-300: #78350f;
  --color-amber-400: #e4a930;
  --color-amber-600: #fbbf24;
  --color-amber-700: #fcd34d;
  --color-amber-800: #fde68a;
}

body {
  background: var(--color-background);
  color: var(--color-foreground);
}

/* Hide scrollbar for cleaner mobile tab scrolling */
.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}
.scrollbar-hide::-webkit-scrollbar {
  display: none;
}

/* Focus ring utility — amber at low opacity */
input:focus,
textarea:focus,
select:focus {
  border-color: #e4a930 !important;
  box-shadow: 0 0 0 3px rgba(228, 169, 48, 0.15) !important;
  outline: none !important;
}

/* ── Mobile touch targets & iOS zoom prevention ──────────── */
@media (max-width: 640px) {
  /* Prevent iOS Safari auto-zoom on input focus (must be ≥16px) */
  input:not([type="checkbox"]):not([type="radio"]):not([type="hidden"]),
  textarea,
  select {
    font-size: 16px !important;
    min-height: 44px;
  }

  /* Generous textareas for homework — clients write meaningful content */
  textarea {
    min-height: 100px;
  }
}

/* ── Subtle page content fade-in ──────────────────────────── */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(4px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.animate-fade-in {
  animation: fadeInUp 150ms ease-out both;
}

/* Force light mode for print */
@media print {
  :root {
    --color-background: #fafaf8 !important;
    --color-foreground: #2d2d2d !important;
    --color-surface: #ffffff !important;
    --color-primary-50: #fafaf8 !important;
    --color-primary-100: #f1f0ee !important;
    --color-primary-200: #e8e8e6 !important;
    --color-primary-800: #2d2d2d !important;
    --color-primary-900: #1a1a1a !important;
  }

  body {
    background: white !important;
    color: black;
    font-size: 11pt;
  }

  /* Page setup — 20mm left for NHS hole-punch */
  @page {
    margin: 15mm 15mm 12mm 20mm;
    size: A4;
  }

  /* Hide non-content elements */
  nav,
  header,
  footer,
  .no-print,
  button {
    display: none !important;
  }

  .print-only {
    display: block !important;
  }

  /* Worksheet table styling for print */
  table {
    border-collapse: collapse;
    width: 100%;
  }

  th,
  td {
    border: 1px solid #ccc;
    padding: 6px 8px;
    text-align: left;
    font-size: 9pt;
  }

  th {
    background: #f5f5f5 !important;
    font-weight: 600;
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Ensure inputs show their values */
  input,
  textarea,
  select {
    border: 1px solid #ccc !important;
    padding: 4px !important;
    background: white !important;
    box-shadow: none !important;
  }

  /* Expand textareas for write-in space */
  textarea {
    min-height: 60px;
  }

  /* Page break management */
  section {
    page-break-inside: avoid;
  }

  h3 {
    page-break-after: avoid;
  }

  /* Preserve colours for domain coding, computed fields, badges */
  [style*="background"],
  [style*="border-color"],
  .bg-amber-50,
  .border-amber-400,
  .bg-red-600,
  .bg-primary-800,
  .bg-green-50,
  .bg-red-50,
  .bg-blue-50 {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Reduce border radius for print */
  .rounded-xl,
  .rounded-2xl {
    border-radius: 8px !important;
  }

  .rounded-lg {
    border-radius: 6px !important;
  }

  /* Remove shadows */
  .shadow-sm,
  .shadow {
    box-shadow: none !important;
  }

  /* Formulation diagrams should not split across pages */
  [class*="grid-cols-3"],
  [class*="grid-cols-2"] {
    page-break-inside: avoid;
  }

  /* ===== Formulation Diagram Print Styles ===== */

  /* Force diagram view on print (not the stacked list) */
  .fml-diagram-view {
    display: block !important;
  }
  .fml-list-view {
    display: none !important;
  }

  /* Prevent formulation from splitting across pages */
  [data-formulation-layout] {
    page-break-inside: avoid;
    break-inside: avoid;
  }

  /* Preserve SVG connection colors and node domain colors */
  [data-formulation-layout] svg,
  [data-formulation-layout] [style*="background"],
  [data-formulation-layout] [style*="border-color"] {
    -webkit-print-color-adjust: exact;
    print-color-adjust: exact;
  }

  /* Formulation node cards: tighter padding, smaller text for A4 fit */
  [data-formulation-layout] .absolute {
    font-size: 9pt;
  }

  /* Ensure SVG pointer-events layer prints */
  [data-formulation-layout] svg.pointer-events-none {
    visibility: visible !important;
    opacity: 1 !important;
  }

  /* Formulation inputs: smaller for print, visible borders */
  [data-formulation-layout] input,
  [data-formulation-layout] textarea,
  [data-formulation-layout] select {
    font-size: 8pt !important;
    padding: 3px !important;
    min-height: 28px;
  }

  /* Formulation textareas: compact for print */
  [data-formulation-layout] textarea {
    min-height: 40px;
  }
}
